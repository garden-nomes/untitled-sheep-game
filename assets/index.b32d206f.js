!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(i){const s=new URL(t,location),r=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((i,h)=>{const n=new URL(t,s);if(self[e].moduleMap[n])return i(self[e].moduleMap[n]);const a=new Blob([`import * as m from '${n}';`,`${e}.moduleMap['${n}']=m;`],{type:"text/javascript"}),o=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(a),onerror(){h(new Error(`Failed to import: ${t}`)),r(o)},onload(){i(self[e].moduleMap[n]),r(o)}});document.head.appendChild(o)})),self[e].moduleMap={}}}("/untitled-sheep-game/");const t={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"};const e={0:[336,0,4,9],1:[343,0,3,9],2:[350,0,4,9],3:[357,0,4,9],4:[364,0,4,9],5:[371,0,4,9],6:[378,0,4,9],7:[385,0,4,9],8:[392,0,4,9],9:[399,0,4,9],"!":[231,0,1,9],'"':[238,0,2,9],"#":[245,0,7,9],$:[252,0,4,9],"%":[259,0,4,9],"&":[266,0,6,9],"'":[273,0,1,9],"(":[280,0,2,9],")":[287,0,2,9],"*":[294,0,5,9],"+":[301,0,5,9],",":[308,0,2,9],"-":[315,0,4,9],".":[322,0,1,9],"/":[329,0,5,9],":":[406,0,1,9],";":[413,0,2,9],"<":[420,0,4,9],"=":[427,0,4,9],">":[434,0,4,9],"?":[441,0,4,9],"@":[0,9,6,9],A:[7,9,4,9],B:[14,9,4,9],C:[21,9,4,9],D:[28,9,4,9],E:[35,9,4,9],F:[42,9,4,9],G:[49,9,4,9],H:[56,9,4,9],I:[63,9,1,9],J:[70,9,4,9],K:[77,9,4,9],L:[84,9,4,9],M:[91,9,5,9],N:[98,9,4,9],O:[105,9,4,9],P:[112,9,4,9],Q:[119,9,4,9],R:[126,9,4,9],S:[133,9,4,9],T:[140,9,3,9],U:[147,9,4,9],V:[154,9,4,9],W:[161,9,5,9],X:[168,9,4,9],Y:[175,9,3,9],Z:[182,9,4,9],"[":[189,9,2,9],"\\":[196,9,5,9],"]":[203,9,2,9],"^":[210,9,3,9],_:[217,9,4,9],"`":[224,9,2,9],a:[231,9,4,9],b:[238,9,4,9],c:[245,9,3,9],d:[252,9,4,9],e:[259,9,4,9],f:[266,9,3,9],g:[273,9,4,9],h:[280,9,4,9],i:[287,9,1,9],j:[294,9,2,9],k:[301,9,3,9],l:[308,9,2,9],m:[315,9,6,9],n:[322,9,5,9],o:[329,9,4,9],p:[336,9,4,9],q:[343,9,4,9],r:[350,9,4,9],s:[357,9,4,9],t:[364,9,4,9],u:[371,9,4,9],v:[378,9,4,9],w:[385,9,5,9],x:[392,9,3,9],y:[399,9,4,9],z:[406,9,4,9],"{":[413,9,4,9],"|":[420,9,1,9],"}":[427,9,4,9],"~":[434,9,6,9],"á":[231,27,1,9],"â":[238,27,4,9],"ã":[245,27,4,9],"ä":[252,27,4,9],"æ":[266,27,1,9],"é":[287,27,7,9]};var i={characters:e},s=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",characters:e,default:i});window.fontData=s;var r=new class{constructor(){this.loaded=!1,this.spaceWidth=4,this.lineHeight=9,this.img=document.createElement("img"),this.img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcAAAAAkCAYAAAAeh+pTAAAAAXNSR0IArs4c6QAABIdJREFUeJztndGW6iAMRa1r/v+XuQ/XrmExEJIQEHTvF0ch4RDahDpaHw8A2JKUUuq1SX2svvPXWu09O+1YGrteH+/cRynHbcWl1tdi55l7ytD6TAWROnfhFJ0A8CKiANb6aZJBLclr2np+tO2lbk/hnUUrFt7CaIm15Fe7Dpb18urcqdhIOp/r5QDAKNd1XfmjlpRSul70+li1RHJd15UXv3yMvACs3tlbYiP187b1xtfEY8Z6WcfQbIws6yr1XzFfAAhmJLGnBnmbdczSTqNPk+g0c/D4jka66mrpHJ2/NJ7Fby+Wks/eGliLVQ/NWN7jN0ojAExm9ITtJctaktRosSQ8bwEotXuKS62/N2FrioNVo0aDVMgsvsv10+rR2PXaLET4iThWAOBQyiRZJulW8pSSnTYRSj5ntK9Am/gtiXfEp2Ys6/ppxrH4HFk3SUuv+O9wvABAABFJJHI3XBZSq5YoHd7xvDaaIt2Ks6ZNardq6hUHb0H2+JTwxtTbn8IIAF8ByW5/WCMAgGBIrPuz5RpZL8Wly/cIO6ut9Hrt79rzFpKdxafWz07rYLHTxqUXM21c7uc9nTU7ad6113t2PdtImxG7ER/R8+v5WxlPWE/r3LT0DxNi+XtFm6RRq39kPKlf1Bx2ibWlrfVa1HhS31Y/ayKdkZS1WjxjRtmM+PDOb0rC2mg88KHJIVZbD8+U/n+xMr3Iv4AaweovIa4c746X1SZ/rLXtxOp4zvBp/VK3R4f3i+k9m/u83KFN0urxuXqzUdrVNleS1sh49ubgiVltPta2Vt+elpqPnJbmSMqxNOP+aJz22iKTpOTTO96MBUjJXvwej98EW0u03uQ7GpfSLtfx7rsojGiJWCOrbSS5hpqeVpukvfRZa5OScuu89OhcTXnu5Y/lmmv+HmmraajZ1Xh3HDWU85k9Xu241sToz63QagvVcpQfOH7pdZ/WtsejvWvq2Xl1euctafEm7BE7KWardm8tygSVt9WSR2nnHXeHue/GTkn3hCKgpbZhaOWyWv8oWnnAG+t7DqXtjHNTW7NKnvkEZxSKlUkkUrtG9ylJ0qrxhDmt4JT1jeSUwvLpa6PZgK68svLkkFY9GV27yGP0pxRkcdyy6fnT2Fm0ePXP8Omdwwot7xxP8plvwiIP7uh1WM1oPL1t1rWfcf550R5D3uN6JJ9pkY5b7dpa5uA9/7RxabUDwBsY3X16bHK8Y59A5PxOiJVW4wlzGSHqXSaNn8hYdj8EA/CJeK40vSfeN+x+o68AI98JgHl4193zrsEu7zIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMC3MXpbqBNuS1beJu7TbxkGAAABSAXjfr1sz59bis2MwjRyP0gAAPhgtFd3tX4926ibF4/QmgMFEFbx5wdxAeAsypsD51d/JxST+8bXJ2gFAIAFzLgC3OlKS/M2LQAAfCG9QtC6wlv5/7oIn61HgNnwFijAoUi/i3bSpyqtv0QOEAU/iAtwMLWicWIhOVEznA8FEADeQuuDLxRDWMU/0mdBp4Btc/0AAAAASUVORK5CYII=",this.img.onload=()=>{this.loaded=!0;const t=document.createElement("canvas");t.width=this.img.naturalWidth,t.height=this.img.naturalHeight;const e=t.getContext("2d");e.drawImage(this.img,0,0),this.data=e.getImageData(0,0,t.width,t.height)}}getCharacterFrame(t){return void 0===e[t]?null:e[t]}};const h={"birb 0.aseprite":{frame:{x:0,y:0,w:3,h:3},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:3,h:3},sourceSize:{w:3,h:3},duration:100},"birb 1.aseprite":{frame:{x:3,y:0,w:3,h:3},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:3,h:3},sourceSize:{w:3,h:3},duration:100},"birb 2.aseprite":{frame:{x:6,y:0,w:3,h:3},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:3,h:3},sourceSize:{w:3,h:3},duration:100},"birb 3.aseprite":{frame:{x:9,y:0,w:3,h:3},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:3,h:3},sourceSize:{w:3,h:3},duration:100},"palette.aseprite":{frame:{x:0,y:3,w:16,h:2},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:2},sourceSize:{w:16,h:2},duration:100},"path 0.aseprite":{frame:{x:0,y:5,w:8,h:8},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:8,h:8},sourceSize:{w:8,h:8},duration:100},"path 1.aseprite":{frame:{x:8,y:5,w:8,h:8},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:8,h:8},sourceSize:{w:8,h:8},duration:100},"path 2.aseprite":{frame:{x:16,y:5,w:8,h:8},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:8,h:8},sourceSize:{w:8,h:8},duration:100},"path 3.aseprite":{frame:{x:24,y:5,w:8,h:8},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:8,h:8},sourceSize:{w:8,h:8},duration:100},"player 0.aseprite":{frame:{x:0,y:13,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"player 1.aseprite":{frame:{x:16,y:13,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"player 2.aseprite":{frame:{x:32,y:13,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"player 3.aseprite":{frame:{x:48,y:13,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"player 4.aseprite":{frame:{x:64,y:13,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"player 5.aseprite":{frame:{x:80,y:13,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"sheep 0.aseprite":{frame:{x:0,y:29,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"sheep 1.aseprite":{frame:{x:16,y:29,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"sheep 2.aseprite":{frame:{x:32,y:29,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"sheep 3.aseprite":{frame:{x:48,y:29,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"sheep 4.aseprite":{frame:{x:64,y:29,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"sheep 5.aseprite":{frame:{x:80,y:29,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"tree.aseprite":{frame:{x:0,y:45,w:32,h:48},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:48},sourceSize:{w:32,h:48},duration:100},"wall 0.aseprite":{frame:{x:0,y:93,w:8,h:8},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:8,h:8},sourceSize:{w:8,h:8},duration:100},"wall 1.aseprite":{frame:{x:8,y:93,w:8,h:8},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:8,h:8},sourceSize:{w:8,h:8},duration:100}},n={birb:["birb 0.aseprite","birb 1.aseprite","birb 2.aseprite","birb 3.aseprite"],path:["path 0.aseprite","path 1.aseprite","path 2.aseprite","path 3.aseprite"],player:["player 0.aseprite","player 1.aseprite","player 2.aseprite","player 3.aseprite","player 4.aseprite","player 5.aseprite"],sheep:["sheep 0.aseprite","sheep 1.aseprite","sheep 2.aseprite","sheep 3.aseprite","sheep 4.aseprite","sheep 5.aseprite"],tree:["tree.aseprite"],wall:["wall 0.aseprite","wall 1.aseprite"]};const a={black:[0,0,0,255],eggplant:[111,103,118,255],beaver:[141,98,104,255],midnightBlue:[65,106,163,255],gray:[154,154,151,255],manatee:[165,147,165,255],timberwolf:[197,204,184,255],plum:[139,85,128,255],mauvelous:[195,136,144,255],violetPurple:[102,96,146,255],chestnut:[154,79,80,255],antiqueBrass:[194,141,117,255],tumbleweed:[190,149,92,255],wildBlueYonder:[124,161,192,255],aquamarine:[104,172,169,255],pineGreen:[56,112,128,255],shadow:[110,105,98,255],asparagus:[147,161,103,255],forestGreen:[110,170,120,255],outerSpace:[85,112,100,255],cadetBlue:[93,104,114,255],white:[230,235,240,255]};var o,l,c=new class{constructor(){this.loaded=!1,this.img=document.createElement("img"),this.img.src="data:image/png;base64,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",this.img.onload=()=>{this.loaded=!0;const t=document.createElement("canvas");t.width=this.img.naturalWidth,t.height=this.img.naturalHeight;const e=t.getContext("2d");e.drawImage(this.img,0,0),this.data=e.getImageData(0,0,t.width,t.height)}}spriteFrame(t,e=0){if(!n[t][e])throw new Error(`Couldn't find frame ${e} of sprite '${t}'`);return h[n[t][e]].frame}};window.font=r,(l=o||(o={}))[l.Left=0]="Left",l[l.Right=1]="Right",l[l.Center=2]="Center";function d(t,e){return[t[0]+e[0],t[1]+e[1]]}function u(t,e){return[t[0]*e,t[1]*e]}function m(t,e){const i=t[0]-e[0],s=t[1]-e[1];return i*i+s*s}function f(t,e){const i=t[0]-e[0],s=t[1]-e[1];return Math.sqrt(i*i+s*s)}function p(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function g(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return[t[0]/e,t[1]/e]}const w=document.querySelector("#fps");w.style.visibility="hidden";const y=document.querySelector("#palette");if(y.style.visibility="hidden",y){const t=y.appendChild(document.createElement("ul"));t.className="palette-list";for(const e in a){const[i,s,r]=a[e],h=t.appendChild(document.createElement("li"));h.className="palette-list_item";const n=h.appendChild(document.createElement("div"));n.className="palette-list_item_label",n.textContent=e;const o=h.appendChild(document.createElement("div"));o.className="palette-list_item_swatch",o.style.background=`rgb(${i},${s},${r})`}}const x=document.querySelector("#app"),A=x.getContext("2d");window.renderer=new class{constructor(t){this.context=t,this.clearColor=[0,0,0,255],this.cameraX=0,this.cameraY=0,this.width=t.canvas.width,this.height=t.canvas.height,this.depthBuffer=new Float32Array(this.width*this.height),this.pixels=t.createImageData(this.width,this.height),this.clear()}clientToGameCoordinates(t,e){const{left:i,top:s,width:r,height:h}=this.context.canvas.getBoundingClientRect();return[(t-i)*(this.width/r),(e-s)*(this.height/h)]}resize(){this.width=this.context.canvas.width,this.height=this.context.canvas.height,this.depthBuffer=new Float32Array(this.width*this.height),this.pixels=this.context.createImageData(this.width,this.height),this.clear()}clear(){this.depthBuffer.fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.pixels.data.length;t+=4)this.pixels.data[t]=this.clearColor[0],this.pixels.data[t+1]=this.clearColor[1],this.pixels.data[t+2]=this.clearColor[2],this.pixels.data[t+3]=this.clearColor[3]}update(){this.context.putImageData(this.pixels,0,0)}set(t,e,i,s=Number.NEGATIVE_INFINITY){if(t-=this.cameraX,e-=this.cameraY,t<0||t>this.width-1||e<0||e>this.height-1)return;const r=e*this.width+t;this.depthBuffer[r]<=s&&(this.depthBuffer[r]=s,this.pixels.data[4*r]=i[0],this.pixels.data[4*r+1]=i[1],this.pixels.data[4*r+2]=i[2],this.pixels.data[4*r+3]=i[3])}camera(t,e){this.cameraX=~~t-~~(width/2),this.cameraY=~~e-~~(height/2)}drawImage(t,e,i,s,r,h,n,a=!1,o=Number.NEGATIVE_INFINITY,l){for(let c=0;c<r;c++)for(let r=0;r<s;r++){const d=4*((i+c)*t.width+(e+r));if(t.data[d+3]>0){const e=l||[t.data[d],t.data[d+1],t.data[d+2],t.data[d+3]];this.set(a?h+s-r:h+r,n+c,e,o)}}}text(t,e,i,s=0,h=palette.black,n){if(r.loaded){e=~~e,i=~~i,1===s?e-=this.textWidth(t):2===s&&(e-=Math.floor(this.textWidth(t)/2));for(const s of t)if(" "===s)e+=r.spaceWidth;else if(null!==r.getCharacterFrame(s)){const[t,a,o,l]=r.getCharacterFrame(s);n&&(this.drawImage(r.data,t,a,o,l,e,i+1,!1,1e4,n),this.drawImage(r.data,t,a,o,l,e+1,i+1,!1,1e4,n)),this.drawImage(r.data,t,a,o,l,e,i,!1,1e4,h),e+=o+1}}}textWidth(t){let e=0;for(const i of t)if(" "===i)e+=r.spaceWidth;else if(null!==r.getCharacterFrame(i)){e+=r.getCharacterFrame(i)[2]+1}return e}spr(t,e,i,s=0,r=!1,h=Number.NEGATIVE_INFINITY){if(!c.loaded)return;e=~~e,i=~~i;const{x:n,y:a,w:o,h:l}=c.spriteFrame(t,s);this.drawImage(c.data,n,a,o,l,e,i,r,h)}line(t,e,i,s,r,h=Number.NEGATIVE_INFINITY){t=~~t,e=~~e,i=~~i,s=~~s;const n=Math.abs(i-t),a=Math.abs(s-e),o=t<i?1:-1,l=e<s?1:-1;let c=n-a;for(;t!==i||e!==s;){const i=c<<1;i>-a&&(c-=a,t+=o),i<n&&(c+=n,e+=l),this.set(t,e,r,h)}}rectfill(t,e,i,s,r,h=Number.NEGATIVE_INFINITY){for(let n=e;n<e+s;n++)for(let e=t;e<t+i;e++)this.set(e,n,r,h)}circfill(t,e,i,s,r=Number.NEGATIVE_INFINITY){t=~~t,e=~~e,i=~~i;let[h,n]=[i,0],a=1-i,o=-2*i,l=1;this.set(t,e+i,s,r),this.set(t,e-i,s,r);for(let c=-i;c<=i;c++)this.set(t+c,e,s,r);for(;n<h;){a>=0&&(h--,o+=2,a+=o),n++,l+=2,a+=l;for(let i=-h;i<=h;i++)this.set(t+i,e+n,s,r),this.set(t+i,e-n,s,r);for(let i=-n;i<=n;i++)this.set(t+i,e+h,s,r),this.set(t+i,e-h,s,r)}}}(A),window.keyboard=new class{constructor(){this.keys={},window.addEventListener("keydown",(t=>{this.keys[t.key]=!0})),window.addEventListener("keyup",(t=>{this.keys[t.key]=!1}))}isDown(e){return this.keys[t[e]]}},window.touchControls=new class{constructor(){this.touchId=null,this.touchPos=null,this.startPos=null,window.addEventListener("touchstart",this.touchStart.bind(this)),window.addEventListener("touchend",this.touchEnd.bind(this)),window.addEventListener("touchmove",this.touchMove.bind(this))}touchStart(t){if(null===this.touchId){const e=t.changedTouches[0];this.touchId=e.identifier;const i=renderer.clientToGameCoordinates(e.clientX,e.clientY);this.startPos=i,this.touchPos=i}}touchEnd(t){for(const e of t.changedTouches)e.identifier===this.touchId&&(this.touchId=null,this.startPos=null,this.touchPos=null)}touchMove(t){for(const s of t.changedTouches)if(s.identifier===this.touchId){const s=t.changedTouches[0],r=renderer.clientToGameCoordinates(s.clientX,s.clientY);this.touchPos=r;const h=48;m(this.touchPos,this.startPos)>h*h&&(this.startPos=d(this.touchPos,u(g((e=this.startPos,i=this.touchPos,[e[0]-i[0],e[1]-i[1]])),h)))}var e,i}draw(){null!==this.touchId&&(renderer.line(renderer.cameraX+this.startPos[0],renderer.cameraY+this.startPos[1],renderer.cameraX+this.touchPos[0],renderer.cameraY+this.touchPos[1],palette.gray,Number.POSITIVE_INFINITY),renderer.circfill(renderer.cameraX+this.startPos[0],renderer.cameraY+this.startPos[1],8,palette.gray,Number.POSITIVE_INFINITY),renderer.circfill(renderer.cameraX+this.touchPos[0],renderer.cameraY+this.touchPos[1],8,palette.chestnut,Number.POSITIVE_INFINITY))}get direction(){if(null===this.touchId)return[0,0];{const[t,e]=this.startPos,[i,s]=this.touchPos;return t===i&&e===s?[0,0]:g([i-t,s-e])}}},window.palette=a,window.width=0,window.height=0,window.deltaTime=0,window.elapsed=0,window.pixels=256,window.showPalette=function(t){y.style.visibility=t?"initial":"hidden"},window.showFps=function(t){w.style.visibility=t?"initial":"hidden"},window.resize=function(){const t=Math.min(Math.floor(window.innerHeight/pixels),Math.floor(window.innerWidth/pixels));x.width=window.innerWidth/t,x.height=window.innerHeight/t,width=x.width,height=x.height,renderer.resize()},resize(),window.addEventListener("resize",resize);const S=Math.pow(2,-52),M=new Uint32Array(512);class b{static from(t,e=C,i=N){const s=t.length,r=new Float64Array(2*s);for(let h=0;h<s;h++){const s=t[h];r[2*h]=e(s),r[2*h+1]=i(s)}return new b(r)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*i),this._halfedges=new Int32Array(3*i),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:i,_hullTri:s,_hullHash:r}=this,h=t.length>>1;let n=1/0,a=1/0,o=-1/0,l=-1/0;for(let S=0;S<h;S++){const e=t[2*S],i=t[2*S+1];e<n&&(n=e),i<a&&(a=i),e>o&&(o=e),i>l&&(l=i),this._ids[S]=S}const c=(n+o)/2,d=(a+l)/2;let u,m,f,p=1/0;for(let S=0;S<h;S++){const e=v(c,d,t[2*S],t[2*S+1]);e<p&&(u=S,p=e)}const g=t[2*u],w=t[2*u+1];p=1/0;for(let S=0;S<h;S++){if(S===u)continue;const e=v(g,w,t[2*S],t[2*S+1]);e<p&&e>0&&(m=S,p=e)}let y=t[2*m],x=t[2*m+1],A=1/0;for(let S=0;S<h;S++){if(S===u||S===m)continue;const e=z(g,w,y,x,t[2*S],t[2*S+1]);e<A&&(f=S,A=e)}let M=t[2*f],b=t[2*f+1];if(A===1/0){for(let s=0;s<h;s++)this._dists[s]=t[2*s]-t[0]||t[2*s+1]-t[1];k(this._ids,this._dists,0,h-1);const e=new Uint32Array(h);let i=0;for(let t=0,s=-1/0;t<h;t++){const r=this._ids[t];this._dists[r]>s&&(e[i++]=r,s=this._dists[r])}return this.hull=e.subarray(0,i),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(T(g,w,y,x,M,b)){const t=m,e=y,i=x;m=f,y=M,x=b,f=t,M=e,b=i}const _=function(t,e,i,s,r,h){const n=i-t,a=s-e,o=r-t,l=h-e,c=n*n+a*a,d=o*o+l*l,u=.5/(n*l-a*o);return{x:t+(l*c-a*d)*u,y:e+(n*d-o*c)*u}}(g,w,y,x,M,b);this._cx=_.x,this._cy=_.y;for(let S=0;S<h;S++)this._dists[S]=v(t[2*S],t[2*S+1],_.x,_.y);k(this._ids,this._dists,0,h-1),this._hullStart=u;let I=3;i[u]=e[f]=m,i[m]=e[u]=f,i[f]=e[m]=u,s[u]=0,s[m]=1,s[f]=2,r.fill(-1),r[this._hashKey(g,w)]=u,r[this._hashKey(y,x)]=m,r[this._hashKey(M,b)]=f,this.trianglesLen=0,this._addTriangle(u,m,f,-1,-1,-1);for(let v,z,k=0;k<this._ids.length;k++){const h=this._ids[k],n=t[2*h],a=t[2*h+1];if(k>0&&Math.abs(n-v)<=S&&Math.abs(a-z)<=S)continue;if(v=n,z=a,h===u||h===m||h===f)continue;let o=0;for(let t=0,e=this._hashKey(n,a);t<this._hashSize&&(o=r[(e+t)%this._hashSize],-1===o||o===i[o]);t++);o=e[o];let l,c=o;for(;l=i[c],!T(n,a,t[2*c],t[2*c+1],t[2*l],t[2*l+1]);)if(c=l,c===o){c=-1;break}if(-1===c)continue;let d=this._addTriangle(c,h,i[c],-1,-1,s[c]);s[h]=this._legalize(d+2),s[c]=d,I++;let p=i[c];for(;l=i[p],T(n,a,t[2*p],t[2*p+1],t[2*l],t[2*l+1]);)d=this._addTriangle(p,h,l,s[h],-1,s[p]),s[h]=this._legalize(d+2),i[p]=p,I--,p=l;if(c===o)for(;l=e[c],T(n,a,t[2*l],t[2*l+1],t[2*c],t[2*c+1]);)d=this._addTriangle(l,h,c,-1,s[c],s[l]),this._legalize(d+2),s[l]=d,i[c]=c,I--,c=l;this._hullStart=e[h]=c,i[c]=e[p]=h,i[h]=p,r[this._hashKey(n,a)]=h,r[this._hashKey(t[2*c],t[2*c+1])]=c}this.hull=new Uint32Array(I);for(let S=0,v=this._hullStart;S<I;S++)this.hull[S]=v,v=i[v];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const i=t/(Math.abs(t)+Math.abs(e));return(e>0?3-i:1+i)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:i,coords:s}=this;let r=0,h=0;for(;;){const n=i[t],a=t-t%3;if(h=a+(t+2)%3,-1===n){if(0===r)break;t=M[--r];continue}const o=n-n%3,l=a+(t+1)%3,c=o+(n+2)%3,d=e[h],u=e[t],m=e[l],f=e[c];if(I(s[2*d],s[2*d+1],s[2*u],s[2*u+1],s[2*m],s[2*m+1],s[2*f],s[2*f+1])){e[t]=f,e[n]=d;const s=i[c];if(-1===s){let e=this._hullStart;do{if(this._hullTri[e]===c){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,s),this._link(n,i[h]),this._link(h,c);const a=o+(n+1)%3;r<M.length&&(M[r++]=a)}else{if(0===r)break;t=M[--r]}}return h}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,i,s,r,h){const n=this.trianglesLen;return this._triangles[n]=t,this._triangles[n+1]=e,this._triangles[n+2]=i,this._link(n,s),this._link(n+1,r),this._link(n+2,h),this.trianglesLen+=3,n}}function v(t,e,i,s){const r=t-i,h=e-s;return r*r+h*h}function _(t,e,i,s,r,h){const n=(s-e)*(r-t),a=(i-t)*(h-e);return Math.abs(n-a)>=33306690738754716e-32*Math.abs(n+a)?n-a:0}function T(t,e,i,s,r,h){return(_(r,h,t,e,i,s)||_(t,e,i,s,r,h)||_(i,s,r,h,t,e))<0}function I(t,e,i,s,r,h,n,a){const o=t-n,l=e-a,c=i-n,d=s-a,u=r-n,m=h-a,f=c*c+d*d,p=u*u+m*m;return o*(d*p-f*m)-l*(c*p-f*u)+(o*o+l*l)*(c*m-d*u)<0}function z(t,e,i,s,r,h){const n=i-t,a=s-e,o=r-t,l=h-e,c=n*n+a*a,d=o*o+l*l,u=.5/(n*l-a*o),m=(l*c-a*d)*u,f=(n*d-o*c)*u;return m*m+f*f}function k(t,e,i,s){if(s-i<=20)for(let r=i+1;r<=s;r++){const s=t[r],h=e[s];let n=r-1;for(;n>=i&&e[t[n]]>h;)t[n+1]=t[n--];t[n+1]=s}else{let r=i+1,h=s;P(t,i+s>>1,r),e[t[i]]>e[t[s]]&&P(t,i,s),e[t[r]]>e[t[s]]&&P(t,r,s),e[t[i]]>e[t[r]]&&P(t,i,r);const n=t[r],a=e[n];for(;;){do{r++}while(e[t[r]]<a);do{h--}while(e[t[h]]>a);if(h<r)break;P(t,r,h)}t[i+1]=t[h],t[h]=n,s-r+1>=h-i?(k(t,e,r,s),k(t,e,i,h-1)):(k(t,e,i,h-1),k(t,e,r,s))}}function P(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}function C(t){return t[0]}function N(t){return t[1]}class E{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,i){const s=(t=+t)+(i=+i),r=e=+e;if(i<0)throw new Error("negative radius");null===this._x1?this._+=`M${s},${r}`:(Math.abs(this._x1-s)>1e-6||Math.abs(this._y1-r)>1e-6)&&(this._+="L"+s+","+r),i&&(this._+=`A${i},${i},0,1,1,${t-i},${e}A${i},${i},0,1,1,${this._x1=s},${this._y1=r}`)}rect(t,e,i,s){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+i}v${+s}h${-i}Z`}value(){return this._||null}}class G{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class F{constructor(t,[e,i,s,r]=[0,0,960,500]){if(!((s=+s)>=(e=+e)&&(r=+r)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=s,this.xmin=e,this.ymax=r,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:i},vectors:s}=this,r=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let u,m,f=0,p=0,g=i.length;f<g;f+=3,p+=2){const e=2*i[f],s=2*i[f+1],h=2*i[f+2],n=t[e],a=t[e+1],o=t[s],l=t[s+1],c=t[h],d=t[h+1],g=o-n,w=l-a,y=c-n,x=d-a,A=g*g+w*w,S=y*y+x*x,M=2*(g*x-w*y);if(M)if(Math.abs(M)<1e-8)u=(n+c)/2,m=(a+d)/2;else{const t=1/M;u=n+(x*A-w*S)*t,m=a+(g*S-y*A)*t}else u=(n+c)/2-1e8*x,m=(a+d)/2+1e8*y;r[p]=u,r[p+1]=m}let h,n,a,o=e[e.length-1],l=4*o,c=t[2*o],d=t[2*o+1];s.fill(0);for(let u=0;u<e.length;++u)o=e[u],h=l,n=c,a=d,l=4*o,c=t[2*o],d=t[2*o+1],s[h+2]=s[l]=a-d,s[h+3]=s[l+1]=c-n}render(t){const e=null==t?t=new E:void 0,{delaunay:{halfedges:i,inedges:s,hull:r},circumcenters:h,vectors:n}=this;if(r.length<=1)return null;for(let l=0,c=i.length;l<c;++l){const e=i[l];if(e<l)continue;const s=2*Math.floor(l/3),r=2*Math.floor(e/3),n=h[s],a=h[s+1],o=h[r],c=h[r+1];this._renderSegment(n,a,o,c,t)}let a,o=r[r.length-1];for(let l=0;l<r.length;++l){a=o,o=r[l];const e=2*Math.floor(s[o]/3),i=h[e],c=h[e+1],d=4*a,u=this._project(i,c,n[d+2],n[d+3]);u&&this._renderSegment(i,c,u[0],u[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new E:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const i=null==e?e=new E:void 0,s=this._clip(t);if(null===s||!s.length)return;e.moveTo(s[0],s[1]);let r=s.length;for(;s[0]===s[r-2]&&s[1]===s[r-1]&&r>1;)r-=2;for(let h=2;h<r;h+=2)s[h]===s[h-2]&&s[h+1]===s[h-1]||e.lineTo(s[h],s[h+1]);return e.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,i=t.length/2;e<i;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new G;return this.renderCell(t,e),e.value()}_renderSegment(t,e,i,s,r){let h;const n=this._regioncode(t,e),a=this._regioncode(i,s);0===n&&0===a?(r.moveTo(t,e),r.lineTo(i,s)):(h=this._clipSegment(t,e,i,s,n,a))&&(r.moveTo(h[0],h[1]),r.lineTo(h[2],h[3]))}contains(t,e,i){return(e=+e)==e&&(i=+i)==i&&this.delaunay._step(t,e,i)===t}*neighbors(t){const e=this._clip(t);if(e)for(const i of this.delaunay.neighbors(t)){const t=this._clip(i);if(t)t:for(let s=0,r=e.length;s<r;s+=2)for(let h=0,n=t.length;h<n;h+=2)if(e[s]==t[h]&&e[s+1]==t[h+1]&&e[(s+2)%r]==t[(h+n-2)%n]&&e[(s+3)%r]==t[(h+n-1)%n]){yield i;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:i,halfedges:s,triangles:r}}=this,h=i[t];if(-1===h)return null;const n=[];let a=h;do{const i=Math.floor(a/3);if(n.push(e[2*i],e[2*i+1]),a=a%3==2?a-2:a+1,r[a]!==t)break;a=s[a]}while(a!==h&&-1!==a);return n}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:i}=this,s=4*t;return i[s]||i[s+1]?this._clipInfinite(t,e,i[s],i[s+1],i[s+2],i[s+3]):this._clipFinite(t,e)}_clipFinite(t,e){const i=e.length;let s,r,h,n,a,o=null,l=e[i-2],c=e[i-1],d=this._regioncode(l,c);for(let u=0;u<i;u+=2)if(s=l,r=c,l=e[u],c=e[u+1],h=d,d=this._regioncode(l,c),0===h&&0===d)n=a,a=0,o?o.push(l,c):o=[l,c];else{let e,i,u,m,f;if(0===h){if(null===(e=this._clipSegment(s,r,l,c,h,d)))continue;[i,u,m,f]=e}else{if(null===(e=this._clipSegment(l,c,s,r,d,h)))continue;[m,f,i,u]=e,n=a,a=this._edgecode(i,u),n&&a&&this._edge(t,n,a,o,o.length),o?o.push(i,u):o=[i,u]}n=a,a=this._edgecode(m,f),n&&a&&this._edge(t,n,a,o,o.length),o?o.push(m,f):o=[m,f]}if(o)n=a,a=this._edgecode(o[0],o[1]),n&&a&&this._edge(t,n,a,o,o.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return o}_clipSegment(t,e,i,s,r,h){for(;;){if(0===r&&0===h)return[t,e,i,s];if(r&h)return null;let n,a,o=r||h;8&o?(n=t+(i-t)*(this.ymax-e)/(s-e),a=this.ymax):4&o?(n=t+(i-t)*(this.ymin-e)/(s-e),a=this.ymin):2&o?(a=e+(s-e)*(this.xmax-t)/(i-t),n=this.xmax):(a=e+(s-e)*(this.xmin-t)/(i-t),n=this.xmin),r?(t=n,e=a,r=this._regioncode(t,e)):(i=n,s=a,h=this._regioncode(i,s))}}_clipInfinite(t,e,i,s,r,h){let n,a=Array.from(e);if((n=this._project(a[0],a[1],i,s))&&a.unshift(n[0],n[1]),(n=this._project(a[a.length-2],a[a.length-1],r,h))&&a.push(n[0],n[1]),a=this._clipFinite(t,a))for(let o,l=0,c=a.length,d=this._edgecode(a[c-2],a[c-1]);l<c;l+=2)o=d,d=this._edgecode(a[l],a[l+1]),o&&d&&(l=this._edge(t,o,d,a,l),c=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,e,i,s,r){for(;e!==i;){let i,h;switch(e){case 5:e=4;continue;case 4:e=6,i=this.xmax,h=this.ymin;break;case 6:e=2;continue;case 2:e=10,i=this.xmax,h=this.ymax;break;case 10:e=8;continue;case 8:e=9,i=this.xmin,h=this.ymax;break;case 9:e=1;continue;case 1:e=5,i=this.xmin,h=this.ymin}s[r]===i&&s[r+1]===h||!this.contains(t,i,h)||(s.splice(r,0,i,h),r+=2)}if(s.length>4)for(let h=0;h<s.length;h+=2){const t=(h+2)%s.length,e=(h+4)%s.length;(s[h]===s[t]&&s[t]===s[e]||s[h+1]===s[t+1]&&s[t+1]===s[e+1])&&(s.splice(t,2),h-=2)}return r}_project(t,e,i,s){let r,h,n,a=1/0;if(s<0){if(e<=this.ymin)return null;(r=(this.ymin-e)/s)<a&&(n=this.ymin,h=t+(a=r)*i)}else if(s>0){if(e>=this.ymax)return null;(r=(this.ymax-e)/s)<a&&(n=this.ymax,h=t+(a=r)*i)}if(i>0){if(t>=this.xmax)return null;(r=(this.xmax-t)/i)<a&&(h=this.xmax,n=e+(a=r)*s)}else if(i<0){if(t<=this.xmin)return null;(r=(this.xmin-t)/i)<a&&(h=this.xmin,n=e+(a=r)*s)}return[h,n]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const W=2*Math.PI,D=Math.pow;function R(t){return t[0]}function B(t){return t[1]}function U(t,e,i){return[t+Math.sin(t+e)*i,e+Math.cos(t-e)*i]}class Y{static from(t,e=R,i=B,s){return new Y("length"in t?function(t,e,i,s){const r=t.length,h=new Float64Array(2*r);for(let n=0;n<r;++n){const r=t[n];h[2*n]=e.call(s,r,n,t),h[2*n+1]=i.call(s,r,n,t)}return h}(t,e,i,s):Float64Array.from(function*(t,e,i,s){let r=0;for(const h of t)yield e.call(s,h,r,t),yield i.call(s,h,r,t),++r}(t,e,i,s)))}constructor(t){this._delaunator=new b(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:i}=t;for(let s=0;s<e.length;s+=3){const t=2*e[s],r=2*e[s+1],h=2*e[s+2];if((i[h]-i[t])*(i[r+1]-i[t+1])-(i[r]-i[t])*(i[h+1]-i[t+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},((t,e)=>e)).sort(((t,i)=>e[2*t]-e[2*i]||e[2*t+1]-e[2*i+1]));const t=this.collinear[0],i=this.collinear[this.collinear.length-1],s=[e[2*t],e[2*t+1],e[2*i],e[2*i+1]],r=1e-8*Math.hypot(s[3]-s[1],s[2]-s[0]);for(let h=0,n=e.length/2;h<n;++h){const t=U(e[2*h],e[2*h+1],r);e[2*h]=t[0],e[2*h+1]=t[1]}this._delaunator=new b(e)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,s=this.hull=this._delaunator.hull,r=this.triangles=this._delaunator.triangles,h=this.inedges.fill(-1),n=this._hullIndex.fill(-1);for(let a=0,o=i.length;a<o;++a){const t=r[a%3==2?a-2:a+1];-1!==i[a]&&-1!==h[t]||(h[t]=a)}for(let a=0,o=s.length;a<o;++a)n[s[a]]=a;s.length<=2&&s.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=s[0],this.triangles[1]=s[1],this.triangles[2]=s[1],h[s[0]]=1,2===s.length&&(h[s[1]]=0))}voronoi(t){return new F(this,t)}*neighbors(t){const{inedges:e,hull:i,_hullIndex:s,halfedges:r,triangles:h,collinear:n}=this;if(n){const e=n.indexOf(t);return e>0&&(yield n[e-1]),void(e<n.length-1&&(yield n[e+1]))}const a=e[t];if(-1===a)return;let o=a,l=-1;do{if(yield l=h[o],o=o%3==2?o-2:o+1,h[o]!==t)return;if(o=r[o],-1===o){const e=i[(s[t]+1)%i.length];return void(e!==l&&(yield e))}}while(o!==a)}find(t,e,i=0){if((t=+t)!=t||(e=+e)!=e)return-1;const s=i;let r;for(;(r=this._step(i,t,e))>=0&&r!==i&&r!==s;)i=r;return r}_step(t,e,i){const{inedges:s,hull:r,_hullIndex:h,halfedges:n,triangles:a,points:o}=this;if(-1===s[t]||!o.length)return(t+1)%(o.length>>1);let l=t,c=D(e-o[2*t],2)+D(i-o[2*t+1],2);const d=s[t];let u=d;do{let s=a[u];const d=D(e-o[2*s],2)+D(i-o[2*s+1],2);if(d<c&&(c=d,l=s),u=u%3==2?u-2:u+1,a[u]!==t)break;if(u=n[u],-1===u){if(u=r[(h[t]+1)%r.length],u!==s&&D(e-o[2*u],2)+D(i-o[2*u+1],2)<c)return u;break}}while(u!==d);return l}render(t){const e=null==t?t=new E:void 0,{points:i,halfedges:s,triangles:r}=this;for(let h=0,n=s.length;h<n;++h){const e=s[h];if(e<h)continue;const n=2*r[h],a=2*r[e];t.moveTo(i[n],i[n+1]),t.lineTo(i[a],i[a+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e=2){const i=null==t?t=new E:void 0,{points:s}=this;for(let r=0,h=s.length;r<h;r+=2){const i=s[r],h=s[r+1];t.moveTo(i+e,h),t.arc(i,h,e,0,W)}return i&&i.value()}renderHull(t){const e=null==t?t=new E:void 0,{hull:i,points:s}=this,r=2*i[0],h=i.length;t.moveTo(s[r],s[r+1]);for(let n=1;n<h;++n){const e=2*i[n];t.lineTo(s[e],s[e+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new G;return this.renderHull(t),t.value()}renderTriangle(t,e){const i=null==e?e=new E:void 0,{points:s,triangles:r}=this,h=2*r[t*=3],n=2*r[t+1],a=2*r[t+2];return e.moveTo(s[h],s[h+1]),e.lineTo(s[n],s[n+1]),e.lineTo(s[a],s[a+1]),e.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,i=t.length/3;e<i;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new G;return this.renderTriangle(t,e),e.value()}}const L=1/4294967296;function X(t,e){return(t%e+e)%e}function*H([t,e],[i,s]){const r=Math.abs(i-t),h=Math.abs(s-e),n=t<i?1:-1,a=e<s?1:-1;let o=r-h;for(;t!==i||e!==s;){const i=o<<1;i>-h&&(o-=h,t+=n,i<r&&(yield[t,e])),i<r&&(o+=r,e+=a),yield[t,e]}}var K,O,J,Q;(O=K||(K={}))[O.Ground=1]="Ground",O[O.Grass=2]="Grass",O[O.Wall=3]="Wall",O[O.Tree=4]="Tree",O[O.Water=5]="Water",O[O.Crossing=6]="Crossing";class V{constructor(t,e){this.width=t,this.height=e,this.sheepStart=[],this.paddock=[0,0,0,0],this.tileSize=8,this.grid=new Int8Array(t*e).fill(1),this.start=[Math.floor(t/2)*this.tileSize,Math.floor(e/2)*this.tileSize],this.seeds=new Float32Array(this.grid.length);for(let i=0;i<this.grid.length;i++)this.seeds[i]=Math.random()}set(t,e,i){if(t<0||t>=this.width||e<0||e>=this.height)return void console.warn(`Grid coordinates out of bounds: (${t}, ${e})`);const s=e*this.width+t;this.grid[s]=i}setLine(t,e,i){for(const[s,r]of H(t,e))this.set(s,r,i)}get(t,e){if(t<0||t>=this.width||e<0||e>=this.height)return 1;const i=e*this.width+t;return this.grid[i]}getSeed(t,e){if(t<0||t>=this.width||e<0||e>=this.height)throw new Error(`Grid coordinates out of bounds: (${t}, ${e})`);const i=e*this.width+t;return this.seeds[i]}getRandom(t,e){return function(t=Math.random()){let e=0|(0<=t&&t<1?t/L:Math.abs(t));return()=>(e=1664525*e+1013904223|0,L*(e>>>0))}(this.getSeed(t,e))}getWorld(t,e){const i=X(Math.floor(t/this.tileSize),this.width),s=X(Math.floor(e/this.tileSize),this.height);return this.get(i,s)}}class q{constructor(t,e){this.map=new V(t,e)}addWall(t,e,i,s,r){[t,e,i,s]=[t,e,i,s].map(Math.round);for(const[h,n]of H([t,e],[i,s]))r&&Math.random()<r||this.map.set(h,n,K.Wall)}addStream(t,e,i,s,r=2){[t,e,i,s]=[t,e,i,s].map(Math.round);const h=~~(r/2);for(const[n,a]of H([t,e],[i,s]))for(let t=0;t<r;t++)for(let e=0;e<r;e++)this.map.set(n+t-h,a+e-h,K.Water)}addCrossing(t,e,i=2){[t,e]=[t,e].map(Math.round);const s=~~(i/2);for(let r=-1;r<i+1;r++)for(let h=-1;h<i+1;h++)this.map.get(t+r-s,e+h-s)===K.Water&&this.map.set(t+r-s,e+h-s,K.Crossing)}addPaddock(t,e){[t,e]=[t,e].map(Math.round);const i=8+~~(4*Math.random()),s=5+~~(3*Math.random()),r=2*i,h=2*s,n=2*(r+h);this.map.paddock=[t-i,e-s,r,h];for(let o=-i;o<=i;o++)for(let i=-s;i<=s;i++){const s=this.map.get(t+o,e+i);s!==K.Water&&s!==K.Crossing&&this.map.set(t+o,e+i,K.Ground)}const a=~~(Math.random()*n);for(let o=0;o<2*(r+h);o++){if(n/2-Math.abs(Math.abs(o-a)-n/2)<5)continue;const l=t-i+~~Math.max(0,Math.min(o,r,2*r+h-o)),c=e-s+~~Math.max(0,Math.min(o-r,h,2*(r+h)-o)),d=this.map.get(l,c);d!==K.Water&&d!==K.Crossing&&this.map.set(l,c,K.Wall),this.plantGrass(t,e)}}plantGrass(t,e){[t,e]=[t,e].map(Math.round),this.map.get(t,e)===K.Ground&&this.map.set(t,e,K.Grass)}iterateGrass(){const t=[];for(let e=0;e<width;e++)for(let i=0;i<height;i++){if(this.map.get(e,i)===K.Ground){const s=(e>0&&this.map.get(e-1,i)===K.Grass?1:0)+(e<width-1&&this.map.get(e+1,i)===K.Grass?1:0)+(i>0&&this.map.get(e,i-1)===K.Grass?1:0)+(i<height-1&&this.map.get(e,i+1)===K.Grass?1:0)+(e>0&&i>0&&this.map.get(e-1,i-1)===K.Grass?1:0)+(e<width-1&&i>0&&this.map.get(e+1,i-1)===K.Grass?1:0)+(e<width-1&&i<height-1&&this.map.get(e+1,i+1)===K.Grass?1:0)+(e>0&&i<height-1&&this.map.get(e-1,i+1)===K.Grass?1:0);Math.random()<.5*s&&t.push([e,i])}}for(const[e,i]of t)this.map.set(e,i,K.Grass)}}function j(t,e){const i=new q(t,e);pixels=256,resize(),renderer.clearColor=palette.timberwolf;const s=[];for(let x=0;x<1e3;x++){const i=Math.random()*t,r=Math.random()*e;s.some((t=>m(t,[i,r])<16))||s.push([i,r])}const r=Y.from(s),h=[],n=s.slice().sort(((i,s)=>m(i,[t/2,e/2])-m(s,[t/2,e/2])));for(let m=0;m<s.length/2;m++)h.push(s.indexOf(n[m]));const a=Y.from(h.map((t=>s[t]))),o=a.hullPolygon();for(let m=0;m<o.length;m++){const[t,e]=o[m],[s,r]=o[(m+1)%o.length];i.addWall(t,e,s,r)}const l=Array.from(a.hull.map((t=>h[t])));let c=[];if(Math.random()>.25){const t=r.hull.length,e=~~(Math.random()*t),i=(e+~~(t/2+.25*(Math.random()-.5)*t))%t;c=function(t,e,i){const s=t.points.length/2,r=new Array(s).fill(null).map(((t,e)=>e)),h=new Array(s).fill(Number.POSITIVE_INFINITY),n=new Array(s).fill(null);for(h[e]=0;r.length;){let e=r[0];for(let t=1;t<r.length;t++)h[r[t]]<h[e]&&(e=r[t]);r.splice(r.indexOf(e),1);for(const i of t.neighbors(e)){const[s,r]=[t.points[2*e],t.points[2*e+1]],[a,o]=[t.points[2*i],t.points[2*i+1]],[l,c]=[a-s,o-r];let d=h[e]+Math.sqrt(l*l+c*c);d<h[i]&&(h[i]=d,n[i]=e)}}const a=[];let o=i;if(null!==n[o]||o===e)for(;null!==o;)a.push(o),o=n[o];return a.reverse(),a}(r,r.hull[e],r.hull[i])}const{halfedges:d,triangles:u}=a,f=.1*Math.random()+.1;for(let m=0;m<d.length;m++){if(Math.random()>f)continue;const t=d[m];if(t<m)continue;const e=h[u[m]],r=h[u[t]];if(c.includes(e)&&c.includes(r))continue;l.push(e),l.push(r);const[n,a]=s[e],[o,p]=s[r];i.addWall(n,a,o,p,Math.random())}for(let m=0;m<c.length-1;m++){const[t,e]=s[c[m]],[r,h]=s[c[m+1]];i.addStream(t,e,r,h)}const p=[];for(let m=0;m<c.length-1;m++)h.includes(c[m])&&!l.includes(c[m])&&(p.push(c[m]),l.push(c[m]));for(let m=0;m<p.length;m++){const[t,e]=s[p[m]];i.addCrossing(t,e),l.push(p[m]),p.splice(m,1)}const g=h.find((t=>!l.includes(t)));i.map.start=s[g].map(Math.round),l.push(g),i.addPaddock(s[g][0],s[g][1]);const w=.5*Math.random()+.25;for(let m=0;m<h.length;m++){const t=h[m];if(!l.includes(t)&&Math.random()<w){const[e,r]=s[t];i.plantGrass(e,r)}}for(let m=0;m<6;m++)i.iterateGrass();const y=h.filter((t=>!l.includes(t)));for(;y.length>0&&i.map.sheepStart.length<8;){const t=~~(Math.random()*y.length);i.map.sheepStart.push(s[y[t]]),y.splice(t,0)}return i.map}class Z{constructor(t,e){this.x=t,this.y=e,this.width=4,this.stride=4,this.max=128,this.footsteps=[],this.footstepAlt=!1,this.color=palette.gray,this.distanceToNextFootstep=0}move(t,e){if((t!==this.x||e!==this.y)&&(this.distanceToNextFootstep-=f([this.x,this.y],[t,e]),this.distanceToNextFootstep<=0)){const[i,s]=g([t-this.x,e-this.y]),[r,h]=this.footstepAlt?[s,-i]:[-s,i];this.footstepAlt=!this.footstepAlt;const n=this.x+r*this.width*.5,a=this.y-1+h*this.width*.5;this.footsteps.push([n,a]),this.footsteps.length>this.max&&this.footsteps.splice(0,1),this.distanceToNextFootstep=this.stride}this.x=t,this.y=e}draw(){for(const[t,e]of this.footsteps)renderer.set(~~t,~~e,this.color,e)}}class ${constructor(){this.x=0,this.y=0,this.vx=0,this.vy=0,this.speed=64,this.reverse=!1,this.animtimer=0,this.footsteps=new Z(this.x,this.y)}update(){this.animtimer+=deltaTime;let t=0,e=0;keyboard.isDown("left")&&t--,keyboard.isDown("right")&&t++,keyboard.isDown("up")&&e--,keyboard.isDown("down")&&e++,0!==t&&0!==e&&(t/=Math.SQRT2,e/=Math.SQRT2),0===t&&0===e&&([t,e]=touchControls.direction),t<0?this.reverse=!0:t>0&&(this.reverse=!1),this.vx=t*this.speed,this.vy=e*this.speed,this.x+=this.vx*deltaTime,this.y+=this.vy*deltaTime,this.footsteps.move(this.x,this.y)}resolveAabbCollision(t,e,i,s){const[r,h,n,a]=[this.x-4,this.y-4,8,4],o=r+n/2-t-i/2,l=i/2+n/2-Math.abs(o);if(l>0){const t=h+a/2-e-s/2,i=s/2+a/2-Math.abs(t);i>0&&(l<i?this.x+=l*(Math.abs(o)/o):this.y+=i*(Math.abs(t)/t))}}get isMoving(){return 0!==this.vx||0!==this.vy}get frame(){if(this.isMoving){const t=Math.floor(6*this.animtimer)%2;return this.reverse?4+t:1+t}return this.reverse?3:0}draw(){renderer.spr("player",this.x-8,this.y-16,this.frame,!1,this.y),this.footsteps.draw()}}class tt{constructor(t,e){this.x=t,this.y=e,this.z=0,this.depth=this.y,this.lifespan=20,this.z=0}update(){const{bugs:t}=lt;this.x+=(2*Math.random()-1)*deltaTime*100,this.y+=(2*Math.random()-1)*deltaTime*100,this.z+=(Math.random()-(this.lifespan<3?.75:.25))*deltaTime*100,this.z<0&&(this.z=0),this.z>16&&(this.z=16),this.lifespan-=deltaTime,this.lifespan<=0&&t.splice(t.indexOf(this),1)}draw(){renderer.set(~~this.x,~~(this.y-this.z),palette.violetPurple,this.y)}}(Q=J||(J={}))[Q.Standing=0]="Standing",Q[Q.Hopping=1]="Hopping",Q[Q.Flying=2]="Flying";class et{constructor(t,e){this.x=t,this.y=e,this.state=0,this.animtimer=0,this.z=0,this.lifetimer=20,this.reverse=!1,this.hops=1,this.flightDirection=Math.random()*Math.PI/2+Math.PI/4}update(){const{player:t,birbs:e}=lt;2!==this.state&&m([this.x,this.y],[t.x,t.y])<2304&&(this.state=2,this.reverse=this.flightDirection<Math.PI/2),0===this.state&&Math.random()<deltaTime/4&&(this.state=1,this.reverse=Math.random()<.5,this.hops=Math.floor(3*Math.random())+1,this.hopStartX=this.x,this.hopTimer=this.hops/4),2===this.state&&(this.x+=96*Math.cos(this.flightDirection)*deltaTime,this.z+=96*Math.sin(this.flightDirection)*deltaTime,this.animtimer+=deltaTime,this.lifetimer-=deltaTime,this.lifetimer<=0&&e.splice(e.indexOf(this),1)),1===this.state&&(this.hopTimer-=deltaTime,this.hopTimer<=0?(this.x=this.hopStartX+4*this.hops*(this.reverse?1:-1),this.z=0,this.state=0):(this.x=this.hopStartX+(1-this.hopTimer/(this.hops/4))*this.hops*4*(this.reverse?1:-1),this.z=2*Math.max(Math.sin(4*this.hopTimer*Math.PI),Math.sin((4*this.hopTimer+1)*Math.PI))))}get frame(){return 2===this.state?Math.floor(8*this.animtimer)%3+1:0}draw(){renderer.spr("birb",this.x-1,this.y-this.z-3,this.frame,this.reverse,this.y)}}var it,st,rt=["Ace","Babbit","Badger","Bambam","Basil","Biggs","Boomboom","Boomer","Bud","Buddy","Bullet","Buster","Butters","Capricorn","Chopper","Chops","Cloud","Coal","Cobalt","Coffee","Comet","Cosmo","Cotton","Cuddles","Dash","Dawson","Dillon","Dodge","Dodger","Duke","Fire","Fluff","Gunther","Hammer","Impact","Jax","Kramer","Lancelot","Lightning","Lucky","Maverick","McCloud","Mercury","Midnight","Monty","Mort","Murky","Mush","Nebula","Nibbler","Nibbles","Nibler","Ogre","Onyx","Orion","Owen","Patches","Patton","Phineas","Pillo","Pitch","Popcorn","Pound","Puff","Rack","Ragget","Rambo","Ramone","Ripple","Rock","Rowan","Rowdy","Ruff","Rufus","Saber","Salt","Satin","Sawyer","Scruffy","Scuddle","Sean","Shawn","Shelby","Silver","Skooter","Slam","Smokey","Smooch","Snow","Snowflake","Soots","Spark","Spartan","Spice","Sponge","Spot","Storm","Striker","Taz","Thunder","Tickles","Truffle","Tumnus","Tweedle","Twinkle","Vanilla","Walnut","Wellington","Woolsley","Agnes","Angel","Aria","Baarbara","Beetle","Bella","Bitsy","Blue","Bonnie","Buffy","Bugsie","Bumble","Bunny","Buttercup","Button","Buttons","Candy","Capri","Chewe","Cloude","Clover","Coco","Cosmo","Cotton","Cream","Creme","Crystal","Cuddle","Cuddles","Cushion","Daahling","Daffodil","Daisy","Darling","Dixie","Dolly","Dora","Dottie","Ebony","Ewey","Fern","Flower","Fluffy","Flufkins","Flurry","Gigi","Ginger","Gloria","Goldilocks","Gorgeous","Honey","Iris","Ivory","Ivy","Jasmin","Jazzy","Lane","Lavender","Libby","Lilly","Linsey","Lucy","Luna","Lyric","Maggie","Maple","Marigold","Midge","Midnight","Minty","Misty","Molly","Momma","Muffin","Nell","Nibble","Nova","Nutmeg","Oreo","Pearl","Pepper","Petunia","Pickle","Puffle","Puffles","Raine","Raspberry","Rosemary","Ruth","Sage","Serenity","Shaggy","Shelly","Sierra","Silver","Smiley","Smooch","Smooches","Snowflake","Snuggle","Snuggles","Snugs","Socks","Speckle","Speckles","Spice","Strawberry","Sugar","Sweetie","Sweetpea","Teeny","Tinkerbell","Tiny","Tulip","Twinkie","Twinkle","Vanilla","Velvet","Venus"];(st=it||(it={}))[st.Idle=0]="Idle",st[st.Walking=1]="Walking",st[st.Running=2]="Running";class ht{constructor(t,e){this.x=t,this.y=e,this.animtimer=0,this.state=0,this.walkDirection=0,this.walkTimer=0,this.reverse=!1,this.isMoving=!1,this.switchDirectionCooldown=0,this.footsteps=new Z(this.x,this.y),this.name=rt[Math.floor(Math.random()*rt.length)],this.footsteps.stride=3,this.footsteps.width=3,this.footsteps.color=palette.manatee}update(){const{player:t}=lt;2!==this.state&&m([this.x,this.y],[t.x,t.y])<1024&&(this.state=2);const e=this.x,i=this.y;0===this.state?this.idle():1===this.state?this.walk():2===this.state&&this.run(),this.switchDirectionCooldown-=deltaTime,this.x!==e||this.y!==i?(this.switchDirectionCooldown<=0&&(this.x<e&&(this.reverse=!1,this.switchDirectionCooldown=.5),this.x>e&&(this.reverse=!0,this.switchDirectionCooldown=.5)),this.isMoving=!0,this.animtimer+=deltaTime):this.isMoving=!1,this.footsteps.move(this.x,this.y)}idle(){const{grassState:t}=lt;this.animtimer=0,!this.isOnGrass&&Math.random()<4*deltaTime?this.startWalking():this.isOnGrass&&t.munch(this.x,this.y)}walk(){this.x+=32*Math.cos(this.walkDirection)*deltaTime,this.y+=32*Math.sin(this.walkDirection)*deltaTime,this.walkTimer-=deltaTime,this.walkTimer<=0&&(this.state=0)}run(){const{player:t,sheep:e}=lt;m([this.x,this.y],[t.x,t.y])>9216&&(this.state=0);let i=0,s=0,r=[this.x-t.x,this.y-t.y],h=p(r);h>0&&(r=u(g(r),Math.max(128-h,0)),i+=r[0],s+=r[1]);let[n,a]=[0,0],o=0;for(const l of e.onscreen){if(l===this||2!==l.state)continue;if(m([l.x,l.y],[this.x,this.y])>9216)continue;let t=[this.x-l.x,this.y-l.y],e=p(t);t=u(g(t),2*Math.max(256-e*e,0)),i+=t[0],s+=t[1],n+=l.x,a+=l.y,o++}if(o>0){n/=o,a/=o;const t=g([n-this.x,a-this.y]);i+=64*t[0],s+=64*t[1]}0===i&&0===s||([i,s]=g([i,s])),this.x+=40*i*deltaTime,this.y+=40*s*deltaTime}onCollide(){this.state=0}resolveAabbCollision(t,e,i,s){const[r,h,n,a]=[this.x-4,this.y-4,8,4],o=r+n/2-t-i/2,l=i/2+n/2-Math.abs(o);if(l>0){const t=h+a/2-e-s/2,i=s/2+a/2-Math.abs(t);i>0&&(l<i?this.x+=l*(Math.abs(o)/o):this.y+=i*(Math.abs(t)/t),this.onCollide())}}startWalking(){const t=this.findGrassNearby();if(null===t)this.walkDirection=Math.random()*Math.PI*2,this.walkTimer=2;else{const[e,i]=t.map((t=>8*t+4));this.walkDirection=Math.atan2(i-this.y,e-this.x),this.walkTimer=f([this.x,this.y],[e,i])/32}this.state=1}findGrassNearby(){const{map:t,grassState:e}=lt,[i,s]=[Math.floor(this.x/8),Math.floor(this.y/8)];let r=null;for(let h=i-6;h<i+6;h++)for(let n=s-6;n<s+6;n++){const a=m([i,s],[h,n]);a<36&&t.get(h,n)===K.Grass&&!e.isMunched(8*h,8*n)&&(null===r||a<m([i,s],r[0])?r=[[h,n]]:null!==r&&a===m([i,s],r[0])&&r.push([h,n]))}return null===r?null:r[~~(Math.random()*r.length)]}get frame(){return this.isMoving?2+Math.floor(8*this.animtimer)%4:this.isOnGrass?1:0}get isOnGrass(){const{map:t,grassState:e}=lt;return t.getWorld(this.x,this.y)===K.Grass&&!e.isMunched(this.x,this.y)}draw(){renderer.spr("sheep",this.x-8,this.y-16,this.frame,this.reverse,this.y),this.footsteps.draw()}}class nt{constructor(){this.items=[],this.onscreen=[],this.margin=32}add(t){this.items.push(t)}remove(t){this.items.splice(this.items.indexOf(t),1)}update(){const t=renderer.cameraX-this.margin,e=renderer.cameraX+width+this.margin,i=renderer.cameraY-this.margin,s=renderer.cameraY+height+this.margin;this.onscreen=this.items.filter((({x:r,y:h})=>r>t&&r<e&&h>i&&h<s))}}class at{constructor(){this.trampled={},this.munched={}}update(){for(const t in this.trampled)this.trampled[t]-=deltaTime,this.trampled[t]<=0&&delete this.trampled[t]}trample(t){this.trampled[t]=4*Math.random()+2}isTrampled(t){return!!this.trampled[t]}munch(t,e){const[i,s]=[t,e].map((t=>~~(t/8))),{map:r}=lt,h=r.getSeed(i,s);void 0===this.munched[h]&&(this.munched[h]=0),this.munched[h]+=deltaTime*Math.random()}isMunched(t,e){const[i,s]=[t,e].map((t=>~~(t/8))),{map:r}=lt,h=r.getSeed(i,s);return this.munched[h]>1}munchedAmount(t,e){const[i,s]=[t,e].map((t=>~~(t/8))),{map:r}=lt,h=r.getSeed(i,s);return this.munched[h]||0}}showFps(!1);const ot={[K.Ground]:palette.timberwolf,[K.Wall]:palette.black,[K.Grass]:palette.asparagus,[K.Tree]:palette.chestnut,[K.Water]:palette.wildBlueYonder,[K.Crossing]:palette.aquamarine},lt=function(){renderer.clearColor=ot[K.Ground],pixels=256,resize();const t=j(512,512),e=new $;e.x=8*t.start[0],e.y=8*t.start[1];const i=new nt;for(const[h,n]of t.sheepStart)i.add(new ht(8*h,8*n));const s=[];for(let h=0;h<t.width*t.height/256;h++){const e=Math.random()*t.width*8,i=Math.random()*t.height*8;s.push(new et(e,i))}const r=new at;return{wind:0,player:e,sheep:i,birbs:s,map:t,bugs:[],grassState:r}}();const{player:ct,sheep:dt,birbs:ut,bugs:mt,map:ft,grassState:pt}=lt;function gt(t,e){const i=ft.get(t,e),s=ft.getRandom(t,e),r=ot[i],h=8*t,n=8*e;i===K.Grass?function(t,e,i,s,r,h){const n=i*s*.1;for(let a=0;a<n;a++){const n=h(),a=t+h()*i,o=e+h()*s;wt(a,o)&&pt.trample(n);let l=pt.isTrampled(n)?1:h()*r;l=Math.max(1,l*(1-pt.munchedAmount(t,e)));const c=h(),d=c<.5?palette.forestGreen:c<.75?palette.pineGreen:palette.outerSpace,u=lt.wind*h();renderer.line(a,o,a+u,o-l,d,o),h()<.1&&renderer.set(~~(a+u),~~(o-l-1),palette.tumbleweed,o)}}(h,n,8,8,12,s):i===K.Wall?function(t,e){const i=8*t,s=8*e,r=ft.get(t,e+1)===K.Wall?1:0;renderer.spr("wall",i,s,r,!1,s+8)}(t,e):i===K.Tree?function(t,e,i){const s=32*i()+8,r=32*i()+8,h=48*i()+8;renderer.rectfill(t+2,e+8-~~s,4,~~s,palette.beaver,e+8);let n=!1;for(let a=e+8-s+1;a>e+8-s-r;a--){const s=(i()-.5)*h+t+4,r=4*i()+4,o=n?palette.forestGreen:palette.outerSpace;n=!n,renderer.circfill(s,a,r,o,e+8)}}(h,n,s):i===K.Ground?function(t,e,i,s,r){const h=Math.floor(i*s*r()*.018);for(let n=0;n<h;n++){const h=r(),n=t+r()*i,a=e+r()*s;wt(n,a)&&pt.trample(h);let o=pt.isTrampled(h)?1:3*r()+1;const l=r()*lt.wind;renderer.line(n,a,n+l,a-o,ot[K.Grass],-1001)}}(h,n,8,8,s):renderer.rectfill(h,n,8,8,r,Number.NEGATIVE_INFINITY)}function wt(t,e){const i=t-ct.x,s=e-ct.y;return i*i+s*s<=16||dt.onscreen.some((i=>{const s=t-i.x,r=e-i.y;if(s*s+r*r<=16)return!0}))}!function(t){let e=performance.now();window.requestAnimationFrame((function i(){const s=performance.now();deltaTime=.001*(s-e),elapsed+=deltaTime,e=s;const r=1/deltaTime;w.textContent="fps: "+r.toFixed(0),w.style.color=r>30?"white":"red",t(),renderer.update(),window.requestAnimationFrame(i)}))}((()=>{renderer.clear(),dt.update(),dt.onscreen.forEach((t=>t.update())),lt.wind=Math.sin(Date.now()/2e3),pt.update(),ct.update(),mt.forEach((t=>t.update())),ut.forEach((t=>t.update())),function(){if((0!==ct.vx||0!==ct.vy)&&ft.getWorld(ct.x,ct.y)===K.Grass&&Math.random()<.25*deltaTime){const t=5*Math.random()+1;for(let e=0;e<t;e++)mt.push(new tt(ct.x,ct.y))}}(),function(){const t=renderer.cameraX,e=renderer.cameraX+width,i=renderer.cameraY,s=renderer.cameraY+height,r=Math.max(Math.floor(t/8)-1,0),h=Math.min(Math.ceil(e/8)+1,ft.width-1),n=Math.max(Math.floor(i/8)-1,0),a=Math.min(Math.ceil(s/8)+1,ft.height-1);for(let o=r;o<=h;o++)for(let t=n;t<=a;t++){const e=ft.get(o,t);if(e===K.Wall||e===K.Water){const e=8*o,i=8*t;ct.resolveAabbCollision(e,i,8,8),dt.onscreen.forEach((t=>t.resolveAabbCollision(e,i,8,8)))}else ft.get(o,t)===K.Tree&&ct.resolveAabbCollision(8*o+2,8*(t+1)-4,4,4)}}();const t=Math.min(Math.max(ct.x,width/2),8*ft.width-width/2),e=Math.min(Math.max(ct.y,height/2),8*ft.height-height/2);renderer.camera(t,e),mt.forEach((t=>t.draw())),ut.forEach((t=>t.draw())),dt.onscreen.forEach((t=>t.draw())),ct.draw(),function(){const t=renderer.cameraX,e=renderer.cameraX+width,i=renderer.cameraY,s=renderer.cameraY+height,r=Math.max(Math.floor(t/8)-2,0),h=Math.min(Math.ceil(e/8)+1,ft.width-1),n=Math.max(Math.floor(i/8)-1,0),a=Math.min(Math.ceil(s/8)+4,ft.height-1);for(let o=r;o<=h;o++)for(let t=n;t<=a;t++)gt(o,t)}(),function(){const[t,e,i,s]=ft.paddock.map((t=>8*t)),r=dt.items.length,h=dt.items.filter((({x:r,y:h})=>r>=t&&r<=t+i&&h>=e&&h<=e+s)).length,n=r-h+" lost sheep remaining";renderer.text(n,t+i/2,e+s+10,o.Center,palette.white)}(),touchControls.draw()}));
